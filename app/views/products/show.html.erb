<% content_for :title, "#{@product.name} - うさぎや" %>

<style>
    body {
        margin: 0;
        padding: 0;
        font-family: 'Noto Sans JP', sans-serif;
        background-color: #fcedf5;
    }

    /* 左上の戻るボタン */
    .back-button-top {
        position: fixed;
        top: 140px;
        left: 2rem;
        z-index: 100;
        display: inline-block;
        padding: 0.75rem 2rem;
        background-color: #ffc0cb;
        border: 1px solid #000;
        color: #000;
        text-decoration: none;
        border-radius: 8px;
        font-weight: 600;
        transition: all 0.3s;
        backdrop-filter: blur(10px);
    }

    .back-button-top:hover {
        background-color: #ff99a9;
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    }

    /* 商品画像セクション(画面中央フルスクリーン) */
    .product-hero-section {
        width: 100%;
        height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        position: relative;
    }

    .product-hero-image {
        max-width: 80%;
        max-height: 80vh;
        object-fit: contain;
        cursor: default;
        animation: imageZoom 1s ease-in-out;
        transition: transform 0.3s ease;
    }

    /* スクロール後のみホバー有効 */
    .product-hero-image.hover-enabled {
        cursor: pointer;
    }

    .product-hero-image.hover-enabled:hover {
        transform: scale(1.3) !important;
    }

    /* 画像拡大アニメーション - 1秒で完了 */
    @keyframes imageZoom {
        0% {
            transform: scale(1);
        }

        50% {
            transform: scale(1.3);
        }

        90% {
            transform: scale(1);
        }

        100% {
            transform: scale(1);
        }
    }

    .no-image-placeholder {
        width: 400px;
        height: 400px;
        display: flex;
        align-items: center;
        justify-content: center;
        background: #ccc;
        color: white;
        font-size: 1.5rem;
        border-radius: 16px;
        backdrop-filter: blur(10px);
        cursor: default;
        animation: imageZoom 1s ease-in-out;
        transition: transform 0.3s ease;
    }

    /* スクロール後のみホバー有効 */
    .no-image-placeholder.hover-enabled {
        cursor: pointer;
    }

    .no-image-placeholder.hover-enabled:hover {
        transform: scale(1.3) !important;
    }

    /* 商品詳細セクション */
    .product-detail-section {
        max-width: 1200px;
        margin: 0 auto;
        padding: 4rem 2rem;
        background: #ede4e1;
    }

    .product-name {
        font-size: 2.5rem;
        font-weight: bold;
        color: #333;
        margin-bottom: 1.5rem;
        padding-bottom: 1rem;
        border-bottom: 3px solid #D5016B;
    }

    .product-price-section {
        margin-bottom: 3rem;
    }

    .product-price-label {
        font-size: 1rem;
        color: #333;
        margin-bottom: 0.5rem;
    }

    .product-price {
        font-size: 3rem;
        font-weight: bold;
        color: #DB2777;
        margin: 0;
    }

    .product-description {
        line-height: 1.8;
        color: #333;
        font-size: 1.1rem;
        margin-bottom: 4rem;
    }

    .product-description h1,
    .product-description h2,
    .product-description h3 {
        margin-top: 2rem;
        margin-bottom: 1rem;
        color: #333;
    }

    .product-description img {
        max-width: 100%;
        height: auto;
        border-radius: 8px;
        margin: 1.5rem 0;
    }

    .product-description p {
        margin-bottom: 1rem;
    }

    /* レスポンシブ対応 */
    @media (max-width: 1024px) {
        .back-button-top {
            top: 130px;
            left: 1.5rem;
            padding: 0.6rem 1.5rem;
            font-size: 0.9rem;
        }

        .product-name {
            font-size: 2rem;
        }

        .product-price {
            font-size: 2.5rem;
        }

        .product-detail-section {
            padding: 3rem 1.5rem;
        }
    }

    @media (max-width: 768px) {
        .back-button-top {
            top: 110px;
            left: 1rem;
            padding: 0.5rem 1rem;
            font-size: 0.85rem;
        }

        .product-hero-image {
            max-width: 90%;
            max-height: 70vh;
        }

        .product-name {
            font-size: 1.75rem;
        }

        .product-price {
            font-size: 2rem;
        }

        .product-description {
            font-size: 1rem;
        }

        .product-detail-section {
            padding: 2rem 1rem;
        }
    }

    @media (max-width: 480px) {
        .back-button-top {
            top: 90px;
            left: 0.75rem;
            padding: 0.5rem 1rem;
            font-size: 0.8rem;
        }

        .product-hero-image {
            max-width: 95%;
            max-height: 60vh;
        }

        .product-name {
            font-size: 1.5rem;
        }

        .product-price {
            font-size: 1.75rem;
        }

        .product-detail-section {
            padding: 1.5rem 0.75rem;
        }
    }
</style>

<!-- 左上の戻るボタン -->
<%= link_to "← 一覧に戻る", :back, class: 'back-button-top' %>

<!-- 商品画像ヒーローセクション -->
<div class="product-hero-section" id="hero-section">
    <% if @product.image.attached? %>
    <%= image_tag @product.image, alt: @product.name, class: 'product-hero-image' %>
    <% else %>
    <div class="no-image-placeholder">
        画像なし
    </div>
    <% end %>
</div>

<!-- 商品詳細セクション -->
<div class="product-detail-section" id="detail-section">
    <h1 class="product-name"><%= @product.name %></h1>

    <div class="product-price-section">
        <p class="product-price-label">価格(税込)</p>
        <p class="product-price">¥<%= number_with_delimiter(@product.price) %></p>
    </div>

    <div class="product-description">
        <%= raw @product.description %>
    </div>
</div>

<%= render 'shared/shop_info' %>

<script>
    // ホバー機能を有効化する関数
    function enableHover() {
        const productImage = document.querySelector('.product-hero-image');
        const placeholder = document.querySelector('.no-image-placeholder');

        if (productImage) {
            productImage.classList.add('hover-enabled');
        }
        if (placeholder) {
            placeholder.classList.add('hover-enabled');
        }
    }

    // 自動スクロール機能
    function setupAutoScroll() {
        let autoScrollCancelled = false;
        let autoScrollTimer = null;
        let scrollDetected = false;

        // ユーザーがスクロールしたら自動スクロールをキャンセル＆ホバー有効化
        function cancelAutoScroll() {
            if (!scrollDetected) {
                scrollDetected = true;
                autoScrollCancelled = true;
                if (autoScrollTimer) {
                    clearTimeout(autoScrollTimer);
                }
                // ホバー機能を有効化
                enableHover();
                // イベントリスナーを削除
                window.removeEventListener('wheel', cancelAutoScroll);
                window.removeEventListener('touchmove', cancelAutoScroll);
                window.removeEventListener('keydown', handleKeydown);
            }
        }

        function handleKeydown(e) {
            // 矢印キー、PageUp/Down、Spaceなどでキャンセル
            if ([32, 33, 34, 35, 36, 37, 38, 39, 40].includes(e.keyCode)) {
                cancelAutoScroll();
            }
        }

        // スクロール系のイベントをリスン
        window.addEventListener('wheel', cancelAutoScroll, {
            passive: true
        });
        window.addEventListener('touchmove', cancelAutoScroll, {
            passive: true
        });
        window.addEventListener('keydown', handleKeydown);

        // 1.0秒後に詳細セクションへスムーズにスクロール
        autoScrollTimer = setTimeout(function() {
            if (!autoScrollCancelled) {
                const detailSection = document.getElementById('detail-section');
                if (detailSection) {
                    detailSection.scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                    // 自動スクロール後にホバー機能を有効化
                    setTimeout(enableHover, 500); // スクロール完了を待つ
                }
                // スクロール後にイベントリスナーを削除
                window.removeEventListener('wheel', cancelAutoScroll);
                window.removeEventListener('touchmove', cancelAutoScroll);
                window.removeEventListener('keydown', handleKeydown);
            }
        }, 1000); // 1.0秒
    }

    // 初回読み込み時
    document.addEventListener('DOMContentLoaded', setupAutoScroll);

    // Turboによるページ遷移時
    document.addEventListener('turbo:load', setupAutoScroll);

    // サイドメニューのJavaScript(ヘッダー用)
    document.addEventListener('turbo:load', function() {
        const hamburger = document.getElementById('hamburger-featured');
        const overlay = document.getElementById('overlay-featured');
        const sideMenu = document.getElementById('sideMenu-featured');
        const closeMenu = document.getElementById('closeMenu-featured');

        if (hamburger && overlay && sideMenu && closeMenu) {
            hamburger.addEventListener('click', function() {
                overlay.style.display = 'block';
                sideMenu.style.right = '0';
            });

            closeMenu.addEventListener('click', function() {
                overlay.style.display = 'none';
                sideMenu.style.right = '-300px';
            });

            overlay.addEventListener('click', function() {
                overlay.style.display = 'none';
                sideMenu.style.right = '-300px';
            });
        }
    });
</script>