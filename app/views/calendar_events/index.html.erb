<%= render 'shared/header' %>

<style>
    /* å–¶æ¥­ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼å°‚ç”¨ã‚¹ã‚¿ã‚¤ãƒ« */
    .calendar-page-wrapper {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Helvetica Neue', 'Hiragino Sans', 'Hiragino Kaku Gothic ProN', Arial, sans-serif;
        background: #FAF4EF;
        min-height: 100vh;
    }

    /* ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ãƒšãƒ¼ã‚¸ãƒ˜ãƒƒãƒ€ãƒ¼ */
    .calendar-page-header {
        background: #fcedf5;
        padding: 180px 20px 40px;
        text-align: center;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }

    .calendar-page-header h1 {
        font-size: 2.5rem;
        color: #333;
        margin-bottom: 10px;
    }

    .calendar-page-header p {
        color: #333;
        font-size: 1rem;
    }

    /* ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚³ãƒ³ãƒ†ãƒŠ */
    .calendar-container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 40px 20px;
        overflow-x: hidden;
    }

    /* ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ */
    .calendar-page-nav {
        background: #F9F9F9;
        border-radius: 15px;
        padding: 20px;
        margin-bottom: 30px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .calendar-page-nav h2 {
        font-size: 1.8rem;
        color: #333;
    }

    .calendar-nav-buttons {
        display: flex;
        gap: 10px;
    }

    .calendar-nav-button {
        padding: 10px 20px;
        background: #ffc0cb;
        color: #333;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-weight: bold;
        text-decoration: none;
        display: flex;
        align-items: center;
        gap: 5px;
        transition: all 0.3s;
    }

    .calendar-nav-button:hover {
        background: #ff69b4;
        transform: translateY(-2px);
    }

    /* ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ãƒ©ãƒƒãƒ‘ãƒ¼ */
    .calendar-page-wrapper-inner {
        background: #fff;
        border-radius: 15px;
        padding: 30px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        margin-bottom: 30px;
        overflow-x: auto;
    }

    .calendar-page-table {
        width: 100%;
        border-collapse: collapse;
    }

    .calendar th.sunday {
        color: #ff6b6b;
    }

    .calendar th.saturday {
        color: #4dabf7;
    }

    .calendar-page-table td {
        padding: 10px;
        border: 1px solid #e9ecef;
        vertical-align: top;
        height: 100px;
        background: #fff;
    }

    .calendar-page-table td.empty {
        background: #f8f9fa;
    }

    .calendar-page-table td.sunday {
        background: #ffe0e0;
    }

    .calendar-page-table td.holiday {
        background: #ffebee;
    }

    .calendar-cell-content {
        width: 100%;
        max-width: 100%;
        overflow: hidden;
    }

    .calendar-day-number {
        font-weight: bold;
        color: #333;
        margin-bottom: 5px;
    }

    .sunday .day-number {
        color: #ff6b6b;
    }

    .calendar-event-label {
        margin: 3px 0;
        padding: 4px 6px;
        border-radius: 4px;
        font-size: 0.7rem;
        font-weight: 500;
        display: block;
        max-width: 100%;
        box-sizing: border-box;
        word-wrap: break-word;
        line-height: 1.3;
        border-left: 3px solid transparent;
    }

    /* å®šä¼‘æ—¥ - èµ¤è‰² */
    .calendar-event-regular-holiday {
        background: #dc3545;
        color: #fff;
        border-left-color: #a71d2a;
    }

    /* ä¸å®šä¼‘ï¼ˆä¼‘æ¥­æ—¥ï¼‰ - è–„ç´…è‰² */
    .calendar-event-irregular-holiday {
        background: #ffb6c1;
        color: #333;
        border-left-color: #ff69b4;
    }

    /* è²©å£²é–‹å§‹æ—¥ - é»„è‰² */
    .calendar-event-sales-start {
        background: #ffc107;
        color: #333;
        border-left-color: #ff9800;
    }

    /* è²©å£²çµ‚äº†æ—¥ - é’è‰² */
    .calendar-event-sales-end {
        background: #007bff;
        color: #fff;
        border-left-color: #0056b3;
    }

    /* ãã®ä»– - ã‚«ã‚¹ã‚¿ãƒ ã‚«ãƒ©ãƒ¼ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰ */
    .calendar-event-other {
        background: linear-gradient(135deg, #ec4899 0%, #8b5cf6 100%);
        color: #fff;
        border-left-color: rgba(0, 0, 0, 0.3);
    }

    /* å‡¡ä¾‹ */
    .legend {
        background: #f8f9fa;
        border-radius: 10px;
        padding: 20px;
        margin-bottom: 30px;
    }

    .legend h3 {
        font-size: 1.2rem;
        color: #333;
        margin-bottom: 15px;
    }

    .legend-items {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 10px;
    }

    .legend-item {
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .legend-color {
        width: 24px;
        height: 24px;
        border-radius: 4px;
    }

    /* åº—èˆ—æƒ…å ± */
    .calendar-store-info {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
    }

    .calendar-info-card {
        background: #fff;
        border-radius: 15px;
        padding: 25px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    }

    .calendar-info-card h3 {
        font-size: 1.3rem;
        color: #ffc0cb;
        margin-bottom: 15px;
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .calendar-info-card p {
        color: #666;
        line-height: 1.8;
        margin-bottom: 10px;
    }

    .calendar-info-card strong {
        color: #333;
    }

    /* æ³¨æ„æ›¸ã */
    .calendar-notice-box {
        background: #fff;
        border-radius: 15px;
        padding: 25px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        border-left: 5px solid #ffc0cb;
    }

    .notice-box h3 {
        font-size: 1.3rem;
        color: #ffc0cb;
        margin-bottom: 15px;
    }

    .notice-box p {
        color: #666;
        line-height: 1.8;
    }

    /* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ– */
    @media (max-width: 768px) {
        .page-header h1 {
            font-size: 1.8rem;
        }

        .calendar-nav {
            flex-direction: column;
            gap: 15px;
        }

        .calendar-nav h2 {
            font-size: 1.5rem;
        }

        .calendar td {
            padding: 5px;
            height: 80px;
            font-size: 0.85rem;
        }

        .event-badge {
            font-size: 0.65rem;
            padding: 2px 5px;
        }

        .event-title {
            display: none;
        }
    }
</style>
</head>

<body>
    <div class="calendar-page-wrapper">
        <!-- ãƒšãƒ¼ã‚¸ãƒ˜ãƒƒãƒ€ãƒ¼ -->
        <div class="calendar-page-header">
            <h1>å–¶æ¥­ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼</h1>
            <p>å®šä¼‘æ—¥ã‚„å–¶æ¥­æ™‚é–“ã‚’ã”ç¢ºèªã„ãŸã ã‘ã¾ã™</p>
        </div>

        <!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
        <div class="calendar-container">
            <!-- ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ -->
            <div class="calendar-page-nav">
                <div class="calendar-nav-buttons">
                    <%= link_to calendar_events_path(year: @prev_year, month: @prev_month), class: "calendar-nav-button" do %>
                    â† å‰æœˆ
                    <% end %>
                </div>

                <h2><%= @year %>å¹´<%= @month %>æœˆ</h2>

                <div class="calendar-nav-buttons">
                    <%= link_to calendar_events_path(year: @next_year, month: @next_month), class: "calendar-nav-button" do %>
                    æ¬¡æœˆ â†’
                    <% end %>
                </div>
            </div>

            <!-- ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ -->
            <div class="calendar-page-wrapper-inner">
                <table class="calendar-page-table">
                    <colgroup>
                        <col style="width: 14.285714%;">
                        <col style="width: 14.285714%;">
                        <col style="width: 14.285714%;">
                        <col style="width: 14.285714%;">
                        <col style="width: 14.285714%;">
                        <col style="width: 14.285714%;">
                        <col style="width: 14.285714%;">
                    </colgroup>
                    <thead>
                        <tr>
                            <th class="sunday">æ—¥</th>
                            <th>æœˆ</th>
                            <th>ç«</th>
                            <th>æ°´</th>
                            <th>æœ¨</th>
                            <th>é‡‘</th>
                            <th class="saturday">åœŸ</th>
                        </tr>
                    </thead>
                    <tbody>
                        <% @calendar.each_slice(7) do |week| %>
                        <tr>
                            <% week.each_with_index do |day, index| %>
                            <% if day[:date].nil? %>
                            <td class="empty"></td>
                            <% else %>
                            <% 
                                is_sunday = day[:date].wday == 0
                                # æ—¥æ›œæ—¥ã¯è‡ªå‹•çš„ã«å®šä¼‘æ—¥ã¨ã—ã¦æ‰±ã†ï¼ˆDBã«ä¿å­˜ã•ã‚Œã¦ã„ãªãã¦ã‚‚ï¼‰
                                all_events = day[:events].to_a
                                if is_sunday && !all_events.any? { |e| e.regular_holiday? }
                                    # ä»®æƒ³çš„ãªå®šä¼‘æ—¥ã‚¤ãƒ™ãƒ³ãƒˆã‚’è¿½åŠ 
                                    virtual_holiday = OpenStruct.new(
                                        event_type: 'regular_holiday',
                                        title: 'å®šä¼‘æ—¥',
                                        color: nil,
                                        regular_holiday?: true,
                                        irregular_holiday?: false,
                                        other?: false
                                    )
                                    all_events.unshift(virtual_holiday)
                                end
                                
                                has_holiday = all_events.any? { |e| e.respond_to?(:regular_holiday?) && e.regular_holiday? } || 
                                              all_events.any? { |e| e.respond_to?(:irregular_holiday?) && e.irregular_holiday? }
                                cell_class = is_sunday ? "sunday" : ""
                                cell_class += " holiday" if has_holiday
                            %>
                            <td class="<%= cell_class %>">
                                <div class="calendar-cell-content">
                                    <div class="calendar-day-number"><%= day[:date].day %></div>
                                    <% all_events.each do |event| %>
                                    <% 
                                            # ã‚¤ãƒ™ãƒ³ãƒˆã‚¿ã‚¤ãƒˆãƒ«ã®æ±ºå®š
                                            event_title = case event.event_type
                                            when 'regular_holiday'
                                                'å®šä¼‘æ—¥'
                                            when 'irregular_holiday'
                                                'ä¼‘æ¥­æ—¥'
                                            else
                                                event.title.present? ? event.title : CalendarEvent.event_type_options.key(event.event_type)
                                            end
                                            
                                            # ã‚«ã‚¹ã‚¿ãƒ ã‚¹ã‚¿ã‚¤ãƒ«ã®è¨­å®šï¼ˆãã®ä»–ã®å ´åˆï¼‰
                                            custom_style = ""
                                            if event.other? && event.color.present?
                                                # èƒŒæ™¯è‰²ã‚’è¨­å®š
                                                custom_style += "background: #{event.color};"
                                                
                                                # èƒŒæ™¯è‰²ã«å¿œã˜ã¦ãƒ†ã‚­ã‚¹ãƒˆè‰²ã‚’è‡ªå‹•èª¿æ•´
                                                # æ˜ã‚‹ã„è‰²ã®å ´åˆã¯é»’æ–‡å­—ã€æš—ã„è‰²ã®å ´åˆã¯ç™½æ–‡å­—
                                                color_hex = event.color.gsub('#', '')
                                                if color_hex.length == 6
                                                    r = color_hex[0..1].to_i(16)
                                                    g = color_hex[2..3].to_i(16)
                                                    b = color_hex[4..5].to_i(16)
                                                    brightness = (r * 299 + g * 587 + b * 114) / 1000
                                                    custom_style += brightness > 155 ? " color: #333;" : " color: #fff;"
                                                end
                                            end
                                        %>
                                    <div class="calendar-event-label calendar-event-<%= event.event_type.tr('_', '-') %>" style="<%= custom_style %>" title="<%= event_title %>">
                                        <%= event_title %>
                                    </div>
                                    <% end %>
                                </div>
                            </td>
                            <% end %>
                            <% end %>
                        </tr>
                        <% end %>
                    </tbody>
                </table>
            </div>

            <!-- åº—èˆ—æƒ…å ± -->
            <div class="calendar-store-info">
                <div class="calendar-info-card">
                    <h3>ğŸ“ ã‚¢ã‚¯ã‚»ã‚¹</h3>
                    <p><strong>ä½æ‰€</strong><br>ç¦äº•çœŒé¯–æ±Ÿå¸‚æŒæ˜å¯ºç”º5-10-1</p>
                </div>

                <div class="calendar-info-card">
                    <h3>â° å–¶æ¥­æ™‚é–“</h3>
                    <p><strong>å¹³æ—¥ãƒ»åœŸæ›œæ—¥:</strong> 9:00ã€œ18:00<br>
                        <strong>å®šä¼‘æ—¥:</strong> æ—¥æ›œæ—¥<br>
                        (æœˆæ›œæ—¥ã«ä¸å®šä¼‘ã‚ã‚Š)
                    </p>
                </div>

                <div class="calendar-info-card">
                    <h3>ğŸ“ ãŠå•ã„åˆã‚ã›</h3>
                    <p><strong>TEL:</strong> 0778-62-0861<br>
                        <%= link_to "ãŠå•ã„åˆã‚ã›ãƒ•ã‚©ãƒ¼ãƒ ", new_inquiry_path, style: "color: #ffc0cb; text-decoration: underline;" %><br>
                        <%= link_to "LINE", "https://page.line.me/296kbwry?openQrModal=true", target: "_blank", style: "color: #ffc0cb; text-decoration: underline;" %><br>
                        <%= link_to "Instagram", "https://www.instagram.com/usagiya.fukui/?hl=ja", target: "_blank", style: "color: #ffc0cb; text-decoration: underline;" %>
                    </p>
                </div>
            </div>

            <!-- æ³¨æ„æ›¸ã -->
            <div class="calendar-notice-box">
                <h3>ã”æ³¨æ„</h3>
                <p>
                    å¤§é‡ç”Ÿç”£ã›ãšã«ã€ä¸€ã¤ä¸€ã¤æ‰‹ä½œã‚Šã—ã¦ãŠã‚Šã¾ã™ã®ã§æ€¥ãªã”æ³¨æ–‡ã«å¯¾å¿œã§ãã‹ã­ã‚‹å ´åˆã‚‚ã‚ã‚Šã¾ã™ã€‚ã”äº†æ‰¿ãã ã•ã„ã€‚<br><br>
                    ãŠæ—©ç›®ã®ã”é€£çµ¡ã‚’ãŠå¾…ã¡ã—ã¦ãŠã‚Šã¾ã™ã€‚
                </p>
            </div>
        </div>
    </div>

    <script>
        // ãƒãƒ³ãƒãƒ¼ã‚¬ãƒ¼ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã®å‹•ä½œ(æ—¢å­˜ã®ãƒ˜ãƒƒãƒ€ãƒ¼ã«ä¾å­˜)
        document.addEventListener('DOMContentLoaded', function() {
            const hamburger = document.querySelector('.hamburger');
            const overlay = document.querySelector('.overlay');
            const sideMenu = document.querySelector('.side-menu');
            const closeBtn = document.querySelector('.side-menu-close');

            if (hamburger && overlay && sideMenu && closeBtn) {
                hamburger.addEventListener('click', function() {
                    overlay.classList.add('active');
                    sideMenu.classList.add('active');
                });

                overlay.addEventListener('click', function() {
                    overlay.classList.remove('active');
                    sideMenu.classList.remove('active');
                });

                closeBtn.addEventListener('click', function() {
                    overlay.classList.remove('active');
                    sideMenu.classList.remove('active');
                });
            }
        });
    </script>
</body>

</html>